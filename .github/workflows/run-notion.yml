name: Freelance Requests Flow

on:
  push:
    branches: [ main ]
  workflow_dispatch: {}   # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ Ù…Ù† GitHub Actions
  schedule:
    # Ù…Ø«Ø§Ù„: ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 8 ØµØ¨Ø§Ø­Ø§Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø±ÙŠØ§Ø¶ (5 UTC)
    - cron: "0 5 * * *"

jobs:
  update-status:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install Python dependencies
        run: |
          echo "ðŸ“¦ Installing Python packages..."
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Notion Python script (update statuses)
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_DB_ID: ${{ secrets.NOTION_DB_ID }}
        run: |
          echo "ðŸš€ Running Notion Python script..."
          python run_notion.py   # Ø§Ù†ØªØ¨Ù‡: Ø¨Ø¯ÙˆÙ† src/

  send-emails:
    needs: update-status        # ÙŠØ´ØºÙ‘Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆØ¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙˆÙ„Ù‰
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install Node dependencies
        run: |
          npm install

      - name: Run email sender
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_DB_ID: ${{ secrets.NOTION_DB_ID }}
          MAIL_USER: ${{ secrets.MAIL_USER }}
          MAIL_PASS: ${{ secrets.MAIL_PASS }}
          MAIL_FROM: ${{ secrets.MAIL_FROM }}
        run: |
          echo "ðŸ“¨ Running email sender..."
          npm run send-status-emails
